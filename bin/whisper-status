#!/usr/bin/env php
<?php

declare(strict_types=1);

/**
 * laravelwhisper Status Command
 * 
 * Check the installation status of Whisper binaries and models.
 */

// Find autoload.php
$autoloadPaths = [
    __DIR__ . '/../vendor/autoload.php',
    __DIR__ . '/../../../autoload.php',
];

$autoloadPath = null;
foreach ($autoloadPaths as $path) {
    if (file_exists($path)) {
        $autoloadPath = $path;
        break;
    }
}

if ($autoloadPath === null) {
    echo "Error: Could not find autoload.php\n";
    echo "Please run: composer install\n";
    exit(1);
}

require $autoloadPath;

use LaravelWhisper\Config;
use LaravelWhisper\Whisper;

// Create service
$config = new Config();
$whisper = new Whisper($config);

// Display header
echo "\n";
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n";
echo "‚ïë              laravelwhisper Installation Status                  ‚ïë\n";
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n";
echo "\n";

// Show configuration
echo "üìã Configuration:\n";
echo "   Model:    {$config->model}\n";
echo "   Language: {$config->language}\n";
echo "   Data Dir: {$config->dataDir}\n";
echo "\n";

// Check status
echo "üìä Installation Status:\n";
$status = $whisper->getStatus();

$binaryStatus = $status['binary'] ? '‚úì Installed' : '‚úó Missing';
$modelStatus = $status['model'] ? '‚úì Installed' : '‚úó Missing';
$ffmpegStatus = $status['ffmpeg'] ? '‚úì Installed' : '‚úó Missing';
$gpuStatus = $status['gpu'] ? '‚úì Available' : '‚úó Not available';

echo "   Binary:  {$binaryStatus}\n";
echo "   Model:   {$modelStatus}\n";
echo "   FFmpeg:  {$ffmpegStatus}\n";
echo "   GPU:     {$gpuStatus}\n";
echo "\n";

// Overall status
$isReady = $status['binary'] && $status['model'] && $status['ffmpeg'];

if ($isReady) {
    echo "‚úÖ Whisper is ready to use!\n";
    echo "\n";
    echo "üìö Quick Start:\n";
    echo "   \$whisper = new Whisper();\n";
    echo "   \$text = \$whisper->audio('/path/to/audio.mp3')->toText();\n";
    echo "\n";
} else {
    echo "‚ö†Ô∏è  Whisper is not fully configured.\n";
    echo "\n";
    echo "üîß Run setup to install missing components:\n";
    echo "   vendor/bin/whisper-setup\n";
    echo "\n";
}

exit($isReady ? 0 : 1);
